<?php
require_once '/var/www/kh/inc/inc_init.php';
?>
<div class="card card-default">
  <div class="card-header">
	<h3 class="card-title">Summary</h3>
	<div class="card-tools">
	  <button type="button" class="btn btn-tool" data-card-widget="collapse">
		<i class="fas fa-minus"></i>
	  </button>
	  <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-remove"></i>
	  </button>
	</div>
  </div>
  <div class="card-body">
	<!-- サイドバー開始 -->
	<div id="nav">
	  <div class="section emphasis">
		<div class="inner">
		  <table border="0" cellspacing="2" cellpadding="2">
			<tr>
			  <td valign="top">
				<table border="1" cellpadding="2" cellspacing="0">
				  <tr>
					<th colspan="3">C Card Information</th>
				  </tr>
				  <tr>
					<th rowspan="6">
					  <table border="0" cellspacing="2" cellpadding="2">
						<tr>
						  <td><a href="/diving/image/OWD.jpg" rel="lightbox" title="C Card">
							  <img src="/diving/image/OWD.jpg" align="left" width="150"
								   height="100" border="0" hspace="10"/></a></td>
						</tr>
						<tr>
						  <td><a href="/diving/image/OWDBack.jpg" rel="lightbox"
								 title="C Card"><img src="/diving/image/OWDBack.jpg"
													 align="left" width="150"
													 height="100" border="0"
													 hspace="10"/></a></td>
						</tr>
					  </table>
					</th>
					<th colspan="2">OWD</th>
				  </tr>
				  <tr>
					<th>Diver NO.</th>
					<td>PJ09166225</td>
				  </tr>
				  <tr>
					<th>Birth Date</th>
					<td>28-Jan-1961</td>
				  </tr>
				  <tr>
					<th>Cert. Date</th>
					<td>10-Jun-2009</td>
				  </tr>
				  <tr>
					<th>Instr. No</th>
					<td>818155-OW<br/>
					  Satsuki Inoda
					</td>
				  </tr>
				  <tr>
					<th>Trained by</th>
					<td>S33039<br/>
					  G-Free/UMI-NO-KYOSHITSU<br/>
					  0980-89-2191
					</td>
				  </tr>
				  <tr>
					<td colspan="3">&nbsp;</td>
				  </tr>
				  <tr>
					<th rowspan="6">
					  <table border="0" cellspacing="2" cellpadding="2">
						<tr>
						  <td><a href="/diving/image/AOW.jpg" rel="lightbox"
								 title="C Card"><img src="/diving/image/AOW.jpg"
													 align="left" width="150"
													 height="100" border="0"
													 hspace="10"/></a></td>
						</tr>
						<tr>
						  <td><a href="/diving/image/AOWBack.jpg" rel="lightbox"
								 title="C Card"><img src="/diving/image/AOWBack.jpg"
													 align="left" width="150"
													 height="100" border="0"
													 hspace="10"/></a></td>
						</tr>
					  </table>
					</th>
					<th colspan="2">AOW</th>
				  </tr>
				  <tr>
					<th>Diver NO.</th>
					<td>1007AU9071</td>
				  </tr>
				  <tr>
					<th>Birth Date</th>
					<td>28-Jan-1961</td>
				  </tr>
				  <tr>
					<th>Cert. Date</th>
					<td>08-Jul-2010</td>
				  </tr>
				  <tr>
					<th>Instr. No</th>
					<td>OWSI-473927<br/>
					  Yuya Kaneko
					</td>
				  </tr>
				  <tr>
					<th>Trained by</th>
					<td>17697<br/>
					  Buddha View Dive Resort<br/>
					  (66) 77-456074
					</td>
				  </tr>
				  <tr>
					<td colspan="3">&nbsp;</td>
				  </tr>
				  <tr>
					<th rowspan="6">
					  <table border="0" cellspacing="2" cellpadding="2">
						<tr>
						  <td><a href="/diving/image/RED.jpg" rel="lightbox"
								 title="C Card"><img src="/diving/image/RED.jpg"
													 align="left" width="150"
													 height="100" border="0"
													 hspace="10"/></a></td>
						</tr>
						<tr>
						  <td><a href="/diving/image/REDBack.jpg" rel="lightbox"
								 title="C Card"><img src="/diving/image/REDBack.jpg"
													 align="left" width="150"
													 height="100" border="0"
													 hspace="10"/></a></td>
						</tr>
					  </table>
					</th>
					<th colspan="2">RED</th>
				  </tr>
				  <tr>
					<th>Diver NO.</th>
					<td>PJ11151200</td>
				  </tr>
				  <tr>
					<th>Birth Date</th>
					<td>28-Jan-1961</td>
				  </tr>
				  <tr>
					<th>Cert. Date</th>
					<td>21-May-2011</td>
				  </tr>
				  <tr>
					<th>Instr. No</th>
					<td>820859-OW<br/>
					  Yojiro Aoyama
					</td>
				  </tr>
				  <tr>
					<th>Trained by</th>
					<td>SO</td>
				  </tr>
				  <tr>
					<td colspan="3">&nbsp;</td>
				  </tr>
				  <tr>
					<th rowspan="6">
					  <table border="0" cellspacing="2" cellpadding="2">
						<tr>
						  <td><a href="/diving/image/enrich.jpg" rel="lightbox" title="C Card"><img
									  src="/diving/image/enrich.jpg"
									  align="left" width="150"
									  height="100" border="0"
									  hspace="10"/></a></td>
						</tr>
						<tr>
						  <td><a href="/diving/image/enrichBack.jpg" rel="lightbox"
								 title="C Card"><img
									  src="/diving/image/enrichBack.jpg" align="left"
									  width="150" height="100" border="0"
									  hspace="10"/></a></td>
						</tr>
					  </table>
					</th>
					<th colspan="2">Enriched Air Specialty</th>
				  </tr>
				  <tr>
					<th>Diver NO.</th>
					<td>PJ11321180</td>
				  </tr>
				  <tr>
					<th>Birth Date</th>
					<td>28-Jan-1961</td>
				  </tr>
				  <tr>
					<th>Cert. Date</th>
					<td>05-Nov-2011</td>
				  </tr>
				  <tr>
					<th>Instr. No</th>
					<td>823273-OW<br/>
					  Yuji Miyamoto
					</td>
				  </tr>
				  <tr>
					<th>Trained by</th>
					<td>S33149<br/>
					  SOUBUZAWA<br/>
					  DIVING CENTER<br/>
					  0558-32-3933
					</td>
				  </tr>
				</table>
			  </td>
			  <td valign="top">
				<table width="200" border="1" cellspacing="0" cellpadding="2">
                    <?php
                    $sql = "
select 
	DiveDate,
	EntryTime,
	ExitTime,
	StartPressure,
	EndPressure,
	DivingTankage.Tankage as Tankage,
	AvarageDepth,
	MaximumDepth
from 
	DivingLog,
	DivingTankage
where
	DivingLog.Tankage = DivingTankage.TankageMaster
";
                    $resultTotal = mysqli_query($link_diving, $sql);
                    $Total = mysqli_num_rows($resultTotal);

                    while ($RowTotal = mysqli_fetch_assoc($resultTotal)) {
                        $EntryTime = $RowTotal["EntryTime"];
                        $ExitTime = $RowTotal["ExitTime"];
                        $StartPressure = $RowTotal["StartPressure"];
                        $EndPressure = $RowTotal["EndPressure"];
                        $Tankage = $RowTotal["Tankage"];
                        $AvarageDepth = $RowTotal["AvarageDepth"];
                        $DiveDate = $RowTotal["DiveDate"];
                        $MaximumDepth = $RowTotal["MaximumDepth"];

                        $DaveDateYear = substr($DiveDate, 0, 4);
                        $DaveDateMonth = substr($DiveDate, 5, 2);
                        $DaveDateDay = substr($DiveDate, 8, 2);

                        $StartHour = substr($EntryTime, 0, 2);
                        $StartMin = substr($EntryTime, 3, 2);
                        $EndHour = substr($ExitTime, 0, 2);
                        $EndMin = substr($ExitTime, 3, 2);

                        $DiveMKTime = mktime($EndHour, $EndMin, 0, $DaveDateMonth, $DaveDateDay, $DaveDateYear) - mktime($StartHour, $StartMin, 0, $DaveDateMonth, $DaveDateDay, $DaveDateYear);

                        $DiveTime = $DiveMKTime / 60;
                        @$DiveTimeTotal = $DiveTimeTotal + $DiveTime;

                        @$AirMin = ($StartPressure - $EndPressure) * $Tankage / ($AvarageDepth / 10 + 1) / $DiveTime;
                        @$AirMinTotal = $AirMinTotal + $AirMin;

                        if ($MaximumDepth > @$MaximumDepthMax) {
                            $MaximumDepthMax = $MaximumDepth;
                        }
                    }
                    $DiveTimeTotalHour = floor($DiveTimeTotal / 60);
                    $DiveTimeTotalMin = $DiveTimeTotal % 60;
                    $AirAve = round(($AirMinTotal / $Total), 2);
                    ?>
				  <tr>
					<th>タンク合計</th>
					<td><?= $Total ?></td>
				  </tr>
				  <tr>
					<th>総潜水時間</th>
					<td><?= $DiveTimeTotalHour ?>時間
                        <?= $DiveTimeTotalMin ?>分
					</td>
				  </tr>
				  <tr>
					<th>エア消費量平均</th>
					<td><?= $AirAve ?>
					  L/min
					</td>
				  </tr>
				  <tr>
					<th>最大潜水深度</th>
					<td><?= $MaximumDepthMax ?>
					  m
					</td>
				  </tr>
				  <tr>
				  <tr>
					<td colspan="2" height="15"></td>
				  </tr>
				  <th>国名</th>
				  <th>タンク数</th>
				  </tr>
                    <?php
                    $sql = "
select 
	count(DivingLogID) as divenum,
	DivingCountry.Country as Country
from 
	DivingLog,
	DivingSite,
	DivingCountry
where
	DivingLog.Site = DivingSite.SiteMaster
	and DivingSite.CountryMaster = DivingCountry.CountryMaster
group by 
	DivingCountry.CountryMaster
order by
	DivingCountry.CountryMaster
";
                    $resultCountry = mysqli_query($link_diving, $sql);
                    while ($rowCountry = mysqli_fetch_assoc($resultCountry)) {
                        $Country = $rowCountry["Country"];
                        $divenum = $rowCountry["divenum"];
//	$Total = $Total + $divenum;
                        echo <<<EOF
						<tr>
							<td>$Country</td>
							<td align="right">$divenum</td>
						</tr>
EOF;
                    }
                    ?>
				  <tr>
					<td colspan="2" height="15"></td>
				  </tr>
				  <tr>
					<th>ダイビングスタイル</th>
					<th>タンク数</th>
				  </tr>
                    <?php
                    $sql = "
select 
	count(DivingLogID) as divenum,
	DivingStyle.Style as StyleName
from 
	DivingLog,
	DivingStyle
where
	DivingLog.Style = DivingStyle.StyleMaster
group by 
	DivingLog.Style, DivingStyle.Style
order by
	DivingLog.Style, DivingStyle.Style
";
                    $resultStyle = mysqli_query($link_diving, $sql);
                    while ($rowStyle = mysqli_fetch_assoc($resultStyle)) {
                        $StyleName = $rowStyle["StyleName"];
                        $divenum = $rowStyle["divenum"];
                        echo <<<EOF
						<tr>
							<td>$StyleName</td>
							<td align="right">$divenum</td>
						</tr>
EOF;
                    }
                    ?>
				  <tr>
					<td colspan="2" height="15"></td>
				  </tr>
				  <tr>
					<th>エントリー方</th>
					<th>タンク数</th>
				  </tr>
                    <?php
                    $sql = "
select 
	count(DivingLogID) as divenum,
	DivingKind.Kind as Kind
from 
	DivingLog,
	DivingKind
where
	DivingLog.Kind = DivingKind.KindMaster
group by 
	DivingKind.KindMaster, DivingKind.Kind
order by
	DivingKind.KindMaster, DivingKind.Kind
";
                    $resultKind = mysqli_query($link_diving, $sql);
                    while ($rowKind = mysqli_fetch_assoc($resultKind)) {
                        $Kind = $rowKind["Kind"];
                        $divenum = $rowKind["divenum"];
//	$Total = $Total + $divenum;
                        echo <<<EOF
						<tr>
							<td>$Kind</td>
							<td align="right">$divenum</td>
						</tr>
EOF;
                    }
                    ?>
				  <tr>
					<td colspan="2" height="15"></td>
				  </tr>
				  <tr>
					<th>酸素濃度</th>
					<th>タンク数</th>
				  </tr>
                    <?php
                    $sql = "
select 
	count(DivingLogID) as divenum,
	DivingOxygen.Oxygen as Oxygen
from 
	DivingLog,
	DivingOxygen
where
	DivingLog.Oxygenlaw = DivingOxygen.OxygenMaster
group by 
	DivingOxygen.OxygenMaster
order by
	DivingOxygen.OxygenMaster
";
                    $resultOxygen = mysqli_query($link_diving, $sql);
                    while ($rowOxygen = mysqli_fetch_assoc($resultOxygen)) {
                        $Oxygen = $rowOxygen["Oxygen"];
                        $divenum = $rowOxygen["divenum"];
//	$Total = $Total + $divenum;
                        echo <<<EOF
						<tr>
							<td>$Oxygen%</td>
							<td align="right">$divenum</td>
						</tr>
EOF;
                    }
                    ?>
				  <tr>
					<td colspan="2" height="15"></td>
				  </tr>
				  <tr>
					<th>水域</th>
					<th>タンク数</th>
				  </tr>
                    <?php
                    $sql = "
select 
	count(DivingLogID) as divenum,
	DivingWater.Water as Water 
from 
	DivingLog,
	DivingWater
where
	DivingLog.Water = DivingWater.WaterMaster
group by 
	DivingWater.WaterMaster, DivingWater.Water
order by
	WaterMaster, DivingWater.Water
";
                    $resultWater = mysqli_query($link_diving, $sql);
                    while ($rowWater = mysqli_fetch_assoc($resultWater)) {
                        $Water = $rowWater["Water"];
                        $divenum = $rowWater["divenum"];
//	$Total = $Total + $divenum;
                        echo <<<EOF
						<tr>
							<td>$Water</td>
							<td align="right">$divenum</td>
						</tr>
EOF;
                    }
                    ?>
				  <tr>
					<td colspan="2" height="15"></td>
				  </tr>
				  <tr>
					<th>海抜</th>
					<th>タンク数</th>
				  </tr>
                    <?php
                    $sql = "
select 
	count(DivingLogID) as divenum,
High
from 
	DivingLog
group by 
	 High
order by
	High
";
                    $resultHigh = mysqli_query($link_diving, $sql);
                    while ($rowHigh = mysqli_fetch_assoc($resultHigh)) {
                        $High = $rowHigh["High"];
                        $divenum = $rowHigh["divenum"];
//	$Total = $Total + $divenum;
                        echo <<<EOF
						<tr>
							<td>$High m</td>
							<td align="right">$divenum</td>
						</tr>
EOF;
                    }
                    ?>
				</table>
				<p>&nbsp;</p></td>
			  <td valign="top">
				<table width="200" border="1" cellspacing="0" cellpadding="2">
				  <tr>
					<th>サイト名</th>
					<th>タンク数</th>
				  </tr>
                    <?php
                    $sql = "
select 
	count(DivingLogID) as divenum,
	DivingSite.Site as Site
from 
	DivingLog,
	DivingSite
where
	DivingLog.Site = DivingSite.SiteMaster
group by 
	DivingLog.Site, DivingSite.Site
order by
	CountryMaster,
	PrefectureMaster, DivingSite.Site
";
                    $resultSite = mysqli_query($link_diving, $sql);
                    while ($rowSite = mysqli_fetch_assoc($resultSite)) {
                        $Site = $rowSite["Site"];
                        $divenum = $rowSite["divenum"];
//	$Total = $Total + $divenum;
                        echo <<<EOF
						<tr>
							<td>$Site</td>
							<td align="right">$divenum</td>
						</tr>
EOF;
                    }
                    ?>
				</table>
			  </td>
			</tr>
		  </table>
		</div>
	  </div>
	  <!-- サイドバー終了 -->
	</div>
	<hr class="clear">
  </div>
  <!-- コンテンツ終了 -->
</div>
